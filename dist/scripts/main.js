"use strict";var width=20,height=20,fps=10,frameLength=1e3/fps,startX=2,startY=2,startLength=10,throughWalls=!0,bgColour="#ECF0F1",snakeColour="#2B3E51",deadColour="#C23824",foodColour="#1FCE6D",scoreColour="#F2C500",SNAKE={},touchEl=document.querySelector(".touch"),hammertime=new Hammer.Manager(touchEl);hammertime.add(new Hammer.Swipe({direction:Hammer.DIRECTION_ALL})),SNAKE.game=function(){function e(){n.fillStyle=bgColour,n.fillRect(0,0,width,height),o.drawScore(n),o.advance(),o.check().crash?o.draw(n,!0):(o.check().food&&(o.eat(),o.longer(1),o.speedup()),o.draw(n),setTimeout(e,frameLength))}function t(){var e={37:"left",38:"up",39:"right",40:"down"},t={2:"left",4:"right",8:"up",16:"down"};document.onkeydown=function(t){var n=t.which,a=e[n];a?(o.setDirection(a),t.preventDefault()):32===n&&r()},hammertime.on("swipe",function(e){e.preventDefault();var r=t[e.direction];r&&o.setDirection(r)})}function r(){var r=document.querySelector("canvas.snake"),a=document.querySelector(".touch").clientWidth,i=document.querySelector(".touch").clientHeight,h=Math.min(a,i);r.style.width=.9*h+"px",r.style.height=.9*h+"px",r.width=width,r.height=height,n=r.getContext("2d"),o=SNAKE.snake(),t(),e()}var n,o;return{init:r}}(),SNAKE.snake=function(){function e(e){var t;switch(m){case"left":case"right":t=["up","down"];break;case"up":case"down":t=["left","right"];break;default:throw"Invalid direction"}t.indexOf(e)>-1?w=e:v=e}function t(e){e.save(),e.fillStyle=scoreColour,e.font="20px courier";var t=s.length-startLength;e.fillText(t,0,20,width)}function r(e,t){var r=t[0],n=t[1];e.fillRect(r,n,1,1)}function n(e,t){e.save(),e.fillStyle=t?deadColour:snakeColour;for(var n=0;n<s.length;n++)r(e,s[n]);e.fillStyle=foodColour,r(e,f),e.restore()}function o(e,t){return(e%t+t)%t}function a(){var t=s[0].slice();switch(m=w,v&&(e(v),v=void 0),m){case"left":t[0]-=1;break;case"up":t[1]-=1;break;case"right":t[0]+=1;break;case"down":t[1]+=1;break;default:throw"Invalid direction"}throughWalls&&(t[0]=o(t[0],width),t[1]=o(t[1],height)),s.unshift(t),this.extend>0?this.extend--:s.pop()}function i(e,t){var r=e[0]===t[0]&&e[1]===t[1];return r}function h(e,t){var r=!1;return t.forEach(function(t){i(e,t)&&(r=!0)}),r}function c(){var e=!1,t=s[0],r=s.slice(1,-1),n=t[0],o=t[1],a=!1;e=!throughWalls&&0>n||n>=width||0>o||o>=height?!0:e,e=h(t,r)?!0:e,i(f,t)&&(a=!0);var c={};return c.crash=e,c.crashHead=t,c.food=a,c}function u(e){this.extend=e}function l(){var e=Math.floor(Math.random()*width),t=Math.floor(Math.random()*height),r=[e,t];h(r,s)?l():f=r}function d(){fps++,frameLength=1e3/fps}for(var s=[],f=[2,10],g=0;startLength>g;g++)s.push([startX,startY-g]);var m="right",w=m,v=w;return{draw:n,advance:a,setDirection:e,check:c,longer:u,eat:l,drawScore:t,speedup:d}},SNAKE.game.init();