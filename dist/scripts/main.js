"use strict";function checkName(){nameEl.value&&"ANON"!==nameEl.value?(nameEl.style.backgroundColor=foodColour,nameEl.style.borderColor=foodColour):(nameEl.style.backgroundColor=nameWarnColour,nameEl.style.borderColor=nameWarnColour)}var width=10,height=10,startFps=5,fps=startFps,frameLength=1e3/fps,startX=2,startY=2,startLength=10,throughWalls=!0,bgColour="#ECF0F1",snakeHeadColour="#2B3E51",snakeColour="#305791",deadColour="#C23824",foodColour="#1AAF5D",scoreColour="#F2C500",nameWarnColour="#F59D00",SNAKE={},touchEl=document.querySelector(".touch"),nameEl=document.querySelector("input.username"),hammertime=new Hammer.Manager(touchEl);hammertime.add(new Hammer.Swipe({direction:Hammer.DIRECTION_ALL})),hammertime.add(new Hammer.Tap({event:"tap",taps:1})),SNAKE.game=function(){function e(){c.fillStyle=bgColour,c.fillRect(0,0,width,height),u.drawScore(c),u.advance(),u.check().crash?(u.die(),o(),u.draw(c,!0)):(u.check().food&&(u.eat(),u.longer(1),u.speedup()),u.draw(c),setTimeout(e,frameLength))}function t(){function t(){u.isDead()&&(u.reset(),e())}var n={37:"left",38:"up",39:"right",40:"down"},r={2:"left",4:"right",8:"up",16:"down"};document.onkeydown=function(e){var r=e.which,o=n[r];o?(u.setDirection(o),e.preventDefault()):32===r?t():checkName()},hammertime.on("swipe",function(e){e.preventDefault();var t=r[e.direction];t&&u.setDirection(t)}),hammertime.on("tap",function(e){e.preventDefault(),t()})}function n(){if(s)return void console.error("Dont init twice");s=!0;var n=document.querySelector("canvas.snake"),r=document.querySelector(".touch").clientWidth,o=document.querySelector(".touch").clientHeight,a=Math.min(r,o);n.style.width=.9*a+"px",n.style.height=.9*a+"px",n.width=width,n.height=height,c=n.getContext("2d"),u=SNAKE.snake(),t(),e(),l=new Firebase("https://snake-scores.firebaseio.com/main"),checkName(),nameEl.onchange=checkName}function r(){return nameEl.value.toUpperCase()}function o(){var e=r()||"ANON",t=u.getScore();l.child(e).once("value",function(n){var r=n.val();(!r||t>r)&&l.child(e).setWithPriority(t,t)}),ga("send","event","game","over",e,t)}function a(){var e=r();Cookies.set("username",e,{expires:1/0})}function i(e){nameEl.value=e}var c,u,l,s=!1,h=Cookies.get("username");return h?i(h):nameEl.focus(),nameEl.addEventListener("change",a),{init:n}}(),SNAKE.snake=function(){function e(){this.dead=!1,fps=startFps,frameLength=1e3/fps,v=[],p=[2,6];for(var e=0;startLength>e;e++)v.push([startX,startY-e]);C="right",k=C,E=k}function t(e){var t;switch(C){case"left":case"right":t=["up","down"];break;case"up":case"down":t=["left","right"];break;default:throw"Invalid direction"}t.indexOf(e)>-1?k=e:E=e}function n(){return v.length-startLength}function r(e){e.save(),e.fillStyle=scoreColour,e.font='8px "5x5 Pixel"',e.fillText(n(),1,height)}function o(e,t){var n=t[0],r=t[1];e.fillRect(n,r,1,1)}function a(e,t){e.save();for(var n=0;n<v.length;n++)0===n?e.fillStyle=snakeHeadColour:e.fillStyle=t?deadColour:snakeColour,o(e,v[n]);e.fillStyle=foodColour,o(e,p),e.restore()}function i(e,t){return(e%t+t)%t}function c(){var e=v[0].slice();switch(C=k,E&&(t(E),E=void 0),C){case"left":e[0]-=1;break;case"up":e[1]-=1;break;case"right":e[0]+=1;break;case"down":e[1]+=1;break;default:throw"Invalid direction"}throughWalls&&(e[0]=i(e[0],width),e[1]=i(e[1],height)),v.unshift(e),this.extend>0?this.extend--:v.pop()}function u(e,t){var n=e[0]===t[0]&&e[1]===t[1];return n}function l(e,t){var n=!1;return t.forEach(function(t){u(e,t)&&(n=!0)}),n}function s(){var e=!1,t=v[0],n=v.slice(1,-1),r=t[0],o=t[1],a=!1;e=!throughWalls&&0>r||r>=width||0>o||o>=height?!0:e,e=l(t,n)?!0:e,u(p,t)&&(a=!0);var i={};return i.crash=e,i.crashHead=t,i.food=a,i}function h(e){this.extend=e}function d(){var e=Math.floor(Math.random()*width),t=Math.floor(Math.random()*height),n=[e,t];l(n,v)?d():p=n}function f(){fps+=.1,frameLength=1e3/fps}function m(){this.dead=!0}function g(){return this.dead}this.dead=!1;for(var v=[],p=[2,6],w=0;startLength>w;w++)v.push([startX,startY-w]);var C="right",k=C,E=k;return{draw:a,advance:c,setDirection:t,check:s,longer:h,eat:d,drawScore:r,speedup:f,die:m,isDead:g,reset:e,getScore:n}},window.onload=SNAKE.game.init();